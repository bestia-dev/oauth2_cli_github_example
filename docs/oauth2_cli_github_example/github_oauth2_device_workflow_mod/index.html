<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="github_oauth2_device_workflow_mod"><title>oauth2_cli_github_example::github_oauth2_device_workflow_mod - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-42caa33d.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="oauth2_cli_github_example" data-themes="" data-resource-suffix="" data-rustdoc-version="1.84.0 (9fc6b4312 2025-01-07)" data-channel="1.84.0" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../oauth2_cli_github_example/index.html">oauth2_<wbr>cli_<wbr>github_<wbr>example</a><span class="version">2025.219.1638</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module github_<wbr>oauth2_<wbr>device_<wbr>workflow_<wbr>mod</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#github_oauth2_device_workflow_mod" title="github_oauth2_device_workflow_mod">github_oauth2_device_workflow_mod</a><ul><li><a href="#secrets" title="Secrets">Secrets</a></li><li><a href="#copy-code-instead-of-dependency-crate" title="Copy code instead of dependency crate">Copy code instead of dependency crate</a></li><li><a href="#store-encrypted-secret-to-file" title="Store encrypted secret to file">Store encrypted secret to file</a></li><li><a href="#in-memory-protection" title="In memory protection">In memory protection</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate oauth2_<wbr>cli_<wbr>github_<wbr>example</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">oauth2_cli_github_example</a></span><h1>Module <span>github_oauth2_device_workflow_mod</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/oauth2_cli_github_example/github_oauth2_device_workflow_mod.rs.html#4-466">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="github_oauth2_device_workflow_mod"><a class="doc-anchor" href="#github_oauth2_device_workflow_mod">§</a>github_oauth2_device_workflow_mod</h2><h3 id="secrets"><a class="doc-anchor" href="#secrets">§</a>Secrets</h3>
<p>In this module there will be a lot of work with secrets.<br />
It is difficult to trust an external crate with your secrets.<br />
External crates can get updated unexpectedly and change to malicious code.</p>
<h3 id="copy-code-instead-of-dependency-crate"><a class="doc-anchor" href="#copy-code-instead-of-dependency-crate">§</a>Copy code instead of dependency crate</h3>
<p>It is best to have the Rust code under your fingertips when dealing with secrets.<br />
Than you know, nobody will touch this code except of you.<br />
You can copy this code directly into your codebase as a module,
inspect and review it and know exactly what is going on.<br />
The code is as linear and readable with comments as possible.
The dependencies in Cargo.toml must also be copied.</p>
<h3 id="store-encrypted-secret-to-file"><a class="doc-anchor" href="#store-encrypted-secret-to-file">§</a>Store encrypted secret to file</h3>
<p>The secrets will be encrypted with an ssh private key and stored in the ~/.ssh folder.<br />
This way the data is protected at rest in storage drive.</p>
<h3 id="in-memory-protection"><a class="doc-anchor" href="#in-memory-protection">§</a>In memory protection</h3>
<p>This is a tough one! There is no 100% software protection of secrets in memory.<br />
Theoretically an attacker could dump the memory in any moment and read the secrets.<br />
There is always a moment when the secret is used in its plaintext form. This cannot be avoided.
All we can do now is to be alert what data is secret and take better care of it.<br />
Every variable that have secrets will have the word <code>secret</code> in it.
When a variable is confusing I will use the word <code>plain</code> to express it is <code>not a secret</code>.
To avoid leaking in logs I will use the <code>secrecy</code> crate. This is not 100% protection.<br />
This is important just to express intent when the secrets are really used.<br />
<code>Secrecy</code> needs the trait <code>zeroize</code> to empty the memory after use for better memory hygiene.
I will add the type names explicitly to emphasis the secrecy types used.
To understand the code try to ignore all this secrecy game back and forth.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.EncFileJson.html" title="struct oauth2_cli_github_example::github_oauth2_device_workflow_mod::EncFileJson">EncFile<wbr>Json</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="struct" href="struct.ResponseSecretAccessToken.html" title="struct oauth2_cli_github_example::github_oauth2_device_workflow_mod::ResponseSecretAccessToken">Response<wbr>Secret<wbr>Access<wbr>Token</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.BLUE.html" title="constant oauth2_cli_github_example::github_oauth2_device_workflow_mod::BLUE">BLUE</a></div><div class="desc docblock-short">ANSI color</div></li><li><div class="item-name"><a class="constant" href="constant.GREEN.html" title="constant oauth2_cli_github_example::github_oauth2_device_workflow_mod::GREEN">GREEN</a></div><div class="desc docblock-short">ANSI color</div></li><li><div class="item-name"><a class="constant" href="constant.RED.html" title="constant oauth2_cli_github_example::github_oauth2_device_workflow_mod::RED">RED</a></div><div class="desc docblock-short">ANSI color</div></li><li><div class="item-name"><a class="constant" href="constant.RESET.html" title="constant oauth2_cli_github_example::github_oauth2_device_workflow_mod::RESET">RESET</a></div><div class="desc docblock-short">ANSI color</div></li><li><div class="item-name"><a class="constant" href="constant.YELLOW.html" title="constant oauth2_cli_github_example::github_oauth2_device_workflow_mod::YELLOW">YELLOW</a></div><div class="desc docblock-short">ANSI color</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.authenticate_with_browser_and_save_file.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::authenticate_with_browser_and_save_file">authenticate_<wbr>with_<wbr>browser_<wbr>and_<wbr>save_<wbr>file</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.authentication_with_browser.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::authentication_with_browser">authentication_<wbr>with_<wbr>browser</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Oauth2 device workflow needs to be authenticated with a browser</div></li><li><div class="item-name"><a class="fn" href="fn.decrypt_file_json.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::decrypt_file_json">decrypt_<wbr>file_<wbr>json</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">decrypt file</div></li><li><div class="item-name"><a class="fn" href="fn.encrypt_and_save_file.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::encrypt_and_save_file">encrypt_<wbr>and_<wbr>save_<wbr>file</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">encrypt and save file</div></li><li><div class="item-name"><a class="fn" href="fn.github_oauth2_device_workflow.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::github_oauth2_device_workflow">github_<wbr>oauth2_<wbr>device_<wbr>workflow</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Start the github oauth2 device workflow
It will use the private key from the .ssh folder.
The encrypted file has the same bare name with the “enc” extension.
Returns access_token to use as bearer for api calls</div></li><li><div class="item-name"><a class="fn" href="fn.open_file_get_json.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::open_file_get_json">open_<wbr>file_<wbr>get_<wbr>json</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">get the file json with expiration dates</div></li><li><div class="item-name"><a class="fn" href="fn.refresh_tokens.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::refresh_tokens">refresh_<wbr>tokens</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">use refresh token to get new access_token and refresh_token</div></li><li><div class="item-name"><a class="fn" href="fn.use_ssh_agent_to_sign_seed.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::use_ssh_agent_to_sign_seed">use_<wbr>ssh_<wbr>agent_<wbr>to_<wbr>sign_<wbr>seed</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Sign seed with ssh-agent</div></li><li><div class="item-name"><a class="fn" href="fn.user_input_passphrase_and_sign_seed.html" title="fn oauth2_cli_github_example::github_oauth2_device_workflow_mod::user_input_passphrase_and_sign_seed">user_<wbr>input_<wbr>passphrase_<wbr>and_<wbr>sign_<wbr>seed</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">User must input the passphrase to unlock the private key file.
Sign the seed with the private key into 32 bytes.
This will be the true passcode for symmetrical encryption and decryption.</div></li></ul></section></div></main></body></html>